var Graph={_data:[],_colors:[],_focus:null,setData:function(t){for(var a in t)t.hasOwnProperty(a)&&(this["_"+a]=t[a]);return this},render:function(){function t(t,a,e){var r=s.append("g").attr("class","sd-stats-graph-subject");if(r.append("path").attr("class","sd-stats-graph-area").attr("fill",t).attr("d",c(a)),r.append("path").attr("class","sd-stats-graph-line").attr("d",p(a)),e){var i=r.append("g").attr("class","sd-stats-graph-points").selectAll(".sd-stats-graph-point").data(n.reverse()).enter().append("g").attr("class","sd-stats-graph-point").attr("transform",function(t,a){return"translate("+l.x(n.length-1-a)+", "+l.y(t.goals)+")"}),o=i.append("g").attr("class","sd-stats-graph-label"),d=10;o.append("path").attr("d","M0,0L24,0");var h=o.append("text").text(function(t){return t.name}).attr("transform","translate(36, 4)").attr("font-size",d);o.insert("rect","text").attr("width",function(t,a){return h[0][a].getBBox().width+24}).attr("height",d+10).attr("transform","translate(24, "+(d+10)/-2+")"),i.append("circle").attr("r",3).attr("fill",e),i.append("circle").attr("r",3).attr("fill","#fff")}}function a(a){a.forEach(function(a){t(a.fill,a.data,a.pointsFill)})}function e(t){var a=24,e=s.append("g").attr("class","sd-stats-graph-legend").attr("transform","translate("+(i.width-a)+", 0)");t.forEach(function(t,s){var r=e.append("g").attr("transform","translate(0, "+(a+16)*s+")");r.append("text").text(t.label).attr("text-anchor","end").attr("transform","translate(-16, 17)"),r.append("rect").attr("width",a).attr("height",a).attr("fill",t.fill)})}var s=d3.select("#sd-stats-graph"),r=$(s[0]);if(this._data.length){r.empty();var n=this._data.sort(function(t,a){return a[this._focus]-t[this._focus]}.bind(this)),i={width:r.width(),height:r.height(),margin:{top:parseInt(r.css("padding-top")),right:parseInt(r.css("padding-right")),bottom:parseInt(r.css("padding-bottom")),left:parseInt(r.css("padding-left"))}},l={x:d3.scale.linear().domain([0,n.length]).range([0,i.width]),y:d3.scale.linear().domain([0,d3.max(n,function(t){return t.points})]).range([i.height,0])},o={x:d3.svg.axis().scale(l.x).orient("bottom").ticks(0),y:d3.svg.axis().scale(l.y).orient("left")};s=s.append("svg").attr("width",i.width+(i.margin.right+i.margin.left)).attr("height",i.height+(i.margin.top+i.margin.bottom)).append("g").attr("transform","translate("+i.margin.left+", "+i.margin.top+")");var d=s.append("g").attr("class","sd-stats-graph-axes");d.append("g").attr("class","sd-stats-graph-axis").attr("transform","translate(0, "+i.height+")").call(o.x).append("text").attr("class","sd-stats-graph-axis-label").attr("transform","translate("+i.width/2+", 24)").attr("text-anchor","middle").text("Players"),d.append("g").attr("class","sd-stats-graph-axis").call(o.y);var p=d3.svg.line().x(function(t,a){return l.x(a)}).y(function(t){return l.y(t)}),c=d3.svg.area().x(function(t,a){return l.x(a)}).y0(i.height).y1(function(t){return l.y(t)}),h=[{label:"Points",fill:"#fff",data:n.map(function(t){return t.points})},{label:"Assists",fill:"url(#diagonal-lines)",data:n.map(function(t){return t.assists})},{label:"Goals",fill:"url(#dots)",data:n.map(function(t){return t.goals}),pointsFill:this._colors[1]}];a(h),e(h)}}};$(window).on("resize",function(){Graph.render()}),_.templateSettings.variable="data";var StatsView=Backbone.View.extend({template:_.template($("#template-sd-stats").html()),render:function(){this.$el.html(this.template(this.model.toJSON())),Graph.setData({data:this.model.get("players").toJSON(),colors:this.model.get("colors"),focus:"goals"}).render()}}),Player=Backbone.Model.extend(),Players=Backbone.Collection.extend({model:Player}),Team=Backbone.Model.extend({initialize:function(t){this.set({players:new Players(t.players)})}}),Teams=Backbone.Collection.extend({model:Team}),teams=new Teams;teams.fetch({url:"/data/teams.json",reset:!0});var TeamItemView=Backbone.View.extend({tagName:"div",className:"sd-team-item",template:_.template($("#template-sd-team-item").html()),events:{click:"onClick"},onClick:function(){this.$el.addClass("sd-selected").siblings().removeClass("sd-selected");var t=new StatsView({model:this.model,el:"#sd-stats"});t.render()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),TeamsListView=Backbone.View.extend({initialize:function(){this.listenTo(this.collection,"reset",this.render)},render:function(){return this.$el.empty(),this.collection.each(function(t){var a=new TeamItemView({model:t});this.$el.append(a.render().el)},this),this}}),teamsListView=new TeamsListView({collection:teams,el:"#sd-teams-list"});teamsListView.render();