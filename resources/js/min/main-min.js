function renderGraph(t,e,a){function s(a,s,n){var i=r.append("g").attr("class","sd-stats-graph-subject");if(i.append("path").attr("class","sd-stats-graph-area").attr("fill",a).attr("d",h(s)),i.append("path").attr("class","sd-stats-graph-line").attr("d",c(s)),n){var l=i.append("g").attr("class","sd-stats-graph-points").selectAll(".sd-stats-graph-point").data(t.reverse()).enter().append("g").attr("class","sd-stats-graph-point").attr("transform",function(e,a){return"translate("+d.x(t.length-1-a)+", "+d.y(e.goals)+")"}),o=l.append("g").attr("class","sd-stats-graph-label"),p=10;o.append("path").attr("d","M0,0L24,0");var m=o.append("text").text(function(t){return t.name}).attr("transform","translate(36, 4)").attr("font-size",p);o.insert("rect","text").attr("width",function(t,e){return m[0][e].getBBox().width+24}).attr("height",p+10).attr("transform","translate(24, "+(p+10)/-2+")"),l.append("circle").attr("r",3).attr("fill",e[1]),l.append("circle").attr("r",3).attr("fill","#fff")}}function n(t){t.forEach(function(t){s(t.fill,t.data,t.showPoints)})}t=t.sort(function(t,e){return e[a]-t[a]});var r=d3.select("#sd-stats-graph"),i=$(r[0]),l={width:i.width(),height:i.height(),margin:{top:parseInt(i.css("padding-top")),right:parseInt(i.css("padding-right")),bottom:parseInt(i.css("padding-bottom")),left:parseInt(i.css("padding-left"))}},d={x:d3.scale.linear().domain([0,t.length]).range([0,l.width]),y:d3.scale.linear().domain([0,d3.max(t,function(t){return t.points})]).range([l.height,0])},o={x:d3.svg.axis().scale(d.x).orient("bottom").ticks(0),y:d3.svg.axis().scale(d.y).orient("left")};r=r.append("svg").attr("width",l.width+(l.margin.right+l.margin.left)).attr("height",l.height+(l.margin.top+l.margin.bottom)).append("g").attr("transform","translate("+l.margin.left+", "+l.margin.top+")");var p=r.append("g").attr("class","sd-stats-graph-axes");p.append("g").attr("class","sd-stats-graph-axis").attr("transform","translate(0, "+l.height+")").call(o.x).append("text").attr("class","sd-stats-graph-axis-label").attr("transform","translate("+l.width/2+", 24)").attr("text-anchor","middle").text("Players"),p.append("g").attr("class","sd-stats-graph-axis").call(o.y);var c=d3.svg.line().x(function(t,e){return d.x(e)}).y(function(t){return d.y(t)}),h=d3.svg.area().x(function(t,e){return d.x(e)}).y0(l.height).y1(function(t){return d.y(t)}),m=[{fill:"#fff",data:t.map(function(t){return t.points}),showPoints:!1},{fill:"url(#diagonal-lines)",data:t.map(function(t){return t.assists}),showPoints:!1},{fill:"url(#dots)",data:t.map(function(t){return t.goals}),showPoints:!0}];n(m)}_.templateSettings.variable="data";var StatsView=Backbone.View.extend({template:_.template($("#template-sd-stats").html()),render:function(){this.$el.html(this.template(this.model.toJSON())),renderGraph(this.model.get("players").toJSON(),this.model.get("colors"),"goals")}}),Player=Backbone.Model.extend(),Players=Backbone.Collection.extend({model:Player}),Team=Backbone.Model.extend({initialize:function(t){this.set({players:new Players(t.players)})}}),Teams=Backbone.Collection.extend({model:Team}),teams=new Teams;teams.fetch({url:"/data/teams.json",reset:!0});var TeamItemView=Backbone.View.extend({tagName:"div",className:"sd-team-item",template:_.template($("#template-sd-team-item").html()),events:{click:"onClick"},onClick:function(){this.$el.addClass("sd-selected").siblings().removeClass("sd-selected");var t=new StatsView({model:this.model,el:"#sd-stats"});t.render()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),TeamsListView=Backbone.View.extend({initialize:function(){this.listenTo(this.collection,"reset",this.render)},render:function(){return this.$el.empty(),this.collection.each(function(t){var e=new TeamItemView({model:t});this.$el.append(e.render().el)},this),this}}),teamsListView=new TeamsListView({collection:teams,el:"#sd-teams-list"});teamsListView.render();